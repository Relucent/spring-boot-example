<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>SockJS+Stomp</title>
<script src="./__/sockjs/1.5.0/sockjs.min.js"></script>
<script src="./__/stomp/2.3.3/stomp.min.js"></script>
<style type="text/css">
html, body, .container {
	height: 100%;
}

#console {
	width: 80%;
	margin-top: 10px;
	height: calc(100% - 200px);
	padding: 10px;
	overflow-y: scroll;
	border: #ccccff solid 1px;
}

#input {
	border: #ccccff solid 1px;
	width: 200px;
	height: 22px;
}

button {
	border: #ccccff solid 1px;
	height: 22px;
}
</style>
</head>
<body>
	<div class="container">
		<div>
			<button id="connect">connect</button>
			<button id="disconnect">disconnect</button>
			<button id="clear">clear</button>
		</div>
		<textarea id="console" readonly="readonly"></textarea>
		<div>
			<input id="input" type="text">
			<button id="send" disabled="disabled">send</button>
		</div>
	</div>
</body>
<script>
	var EL = {
		connect : document.querySelector('#connect'),
		disconnect : document.querySelector('#disconnect'),
		clear : document.querySelector('#clear'),
		console : document.querySelector('#console'),
		input : document.querySelector('#input'),
		send : document.querySelector('#send')
	}, Option = {
		url : 'http://localhost:8080/websocket',
		headers : {
			'x-token' : 'root'
		},
		topic : '/topic/hello'
	}, Engine = {
		client : null
	}, FN = {
		connect : function() {
			FN.disconnect();
			var socket = new SockJS(Option.url);
			var client = Engine.client = Stomp.over(socket);
			//client.debug = null
			client.connect(Option.headers, function() {
				client.subscribe(Option.topic, function(event) {
					EL.console.value = EL.console.value + event.body + '\n';
					EL.console.scrollTop = EL.console.scrollHeight
				}, Option.headers);
				EL.send.disabled = false;
			}, function(e) {
				Engine.client = null;
			});
		},
		disconnect : function() {
			if (Engine.client != null) {
				Engine.client.disconnect();
				Engine.client = null;
				EL.send.disabled = true;
			}
		},
		clear : function() {
			EL.console.value = '';
		},
		send : function(message) {
			if (Engine.client != null || !message) {
				Engine.client.send('/topic/hello-send', Option.headers, JSON.stringify({
					'message' : message
				}));
			}
		}
	}
	EL.send.disabled = true;
	EL.connect.addEventListener('click', function() {
		FN.connect();
	}, false);
	EL.disconnect.addEventListener('click', function() {
		FN.disconnect();
	}, false);
	EL.clear.addEventListener('click', function() {
		FN.clear();
	}, false);
	EL.send.addEventListener('click', function() {
		FN.send(EL.input.value);
	}, false);
</script>
</body>
</html>